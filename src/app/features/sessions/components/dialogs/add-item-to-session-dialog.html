<form [formGroup]="form" class="dialog-form">
    <!-- Item Selection -->
    <div class="form-field">
        <label for="item">
            Item <span class="required">*</span>
        </label>
        <p-select
            inputId="item"
            formControlName="item_id"
            [options]="itemOptions()"
            optionLabel="label"
            optionValue="value"
            placeholder="Seleccionar item"
            [filter]="true"
            filterBy="label"
            [showClear]="true"
            [loading]="loading()"
            appendTo="body"
            styleClass="w-full"
        />
        @if (form.get('item_id')?.invalid && form.get('item_id')?.touched) {
        <small class="error-message">El item es requerido</small>
        }
    </div>

    <!-- Item Details -->
    @if (selectedItem()) {
    <div class="item-details">
        <div class="detail-row">
            <span class="detail-label">Precio Unitario:</span>
            <span class="unit-price-value">Q {{ formatCurrency(parseFloat(selectedItem()!.unit_price)) }}</span>
        </div>

        @if (selectedItem()!.description) {
        <div class="description-section">
            <span class="detail-label">Descripci√≥n:</span>
            <p class="description-text">{{ selectedItem()!.description }}</p>
        </div>
        }
    </div>
    }

    <!-- Quantity -->
    <div class="form-field quantity-field">
        <label for="quantity">
            Cantidad <span class="required">*</span>
        </label>
        <p-inputnumber
            inputId="quantity"
            formControlName="quantity"
            [min]="1"
            [max]="100"
            [showButtons]="true"
            buttonLayout="horizontal"
            spinnerMode="horizontal"
            incrementButtonIcon="pi pi-plus"
            decrementButtonIcon="pi pi-minus"
            styleClass="w-full"
        />
        @if (form.get('quantity')?.invalid && form.get('quantity')?.touched) {
        <small class="error-message">La cantidad debe ser al menos 1</small>
        }
    </div>

    <!-- Subtotal -->
    @if (subtotal() > 0) {
    <div class="subtotal-section">
        <div class="subtotal-row">
            <span class="subtotal-label">Subtotal:</span>
            <span class="subtotal-value">Q {{ formatCurrency(subtotal()) }}</span>
        </div>
    </div>
    }

    <!-- Actions -->
    <div class="dialog-actions">
        <p-button
            label="Cancelar"
            severity="secondary"
            [text]="true"
            (onClick)="cancel()"
            [disabled]="submitting()"
        />
        <p-button
            label="Agregar Item"
            icon="pi pi-plus"
            (onClick)="onSubmit()"
            [disabled]="form.invalid || submitting()"
            [loading]="submitting()"
        />
    </div>
</form>
