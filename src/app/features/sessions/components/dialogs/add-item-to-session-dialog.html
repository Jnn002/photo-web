<div class="flex flex-column gap-4">
  <!-- Item Selection -->
  <div>
    <label for="item" class="block text-900 font-medium mb-2">
      Item <span class="text-red-500">*</span>
    </label>
    <p-select
      inputId="item"
      formControlName="item_id"
      [options]="itemOptions()"
      optionLabel="label"
      optionValue="value"
      placeholder="Seleccionar item"
      [filter]="true"
      filterBy="label"
      [showClear]="true"
      [loading]="loading()"
      styleClass="w-full"
      [formGroup]="form"
    />
    @if (form.get('item_id')?.invalid && form.get('item_id')?.touched) {
    <small class="p-error">El item es requerido</small>
    }
  </div>

  <!-- Item Details -->
  @if (selectedItem()) {
  <p-message severity="info" styleClass="w-full">
    <div class="flex flex-column gap-2">
      <div class="flex justify-content-between">
        <span class="font-medium">Precio Unitario:</span>
        <span>Q {{ formatCurrency(parseFloat(selectedItem()!.unit_price)) }}</span>
      </div>
      @if (selectedItem()!.description) {
      <div>
        <span class="font-medium">Descripci√≥n:</span>
        <p class="mt-1 mb-0">{{ selectedItem()!.description }}</p>
      </div>
      }
    </div>
  </p-message>
  }

  <!-- Quantity -->
  <div>
    <label for="quantity" class="block text-900 font-medium mb-2">
      Cantidad <span class="text-red-500">*</span>
    </label>
    <p-inputnumber
      inputId="quantity"
      formControlName="quantity"
      [min]="1"
      [max]="100"
      [showButtons]="true"
      styleClass="w-full"
      [formGroup]="form"
    />
    @if (form.get('quantity')?.invalid && form.get('quantity')?.touched) {
    <small class="p-error">La cantidad debe ser al menos 1</small>
    }
  </div>

  <!-- Subtotal -->
  @if (subtotal() > 0) {
  <div class="bg-primary-50 border-round p-3">
    <div class="flex justify-content-between align-items-center">
      <span class="text-900 font-bold text-lg">Subtotal:</span>
      <span class="text-primary font-bold text-2xl"
        >Q {{ formatCurrency(subtotal()) }}</span
      >
    </div>
  </div>
  }

  <!-- Actions -->
  <div class="flex justify-content-end gap-2 mt-3">
    <p-button
      label="Cancelar"
      severity="secondary"
      [text]="true"
      (onClick)="cancel()"
      [disabled]="submitting()"
    />
    <p-button
      label="Agregar Item"
      icon="pi pi-plus"
      (onClick)="onSubmit()"
      [disabled]="form.invalid || submitting()"
      [loading]="submitting()"
    />
  </div>
</div>
