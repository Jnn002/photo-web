<p-confirmDialog />

<div class="items-manager-container">
  <!-- Header -->
  <div class="manager-header">
    <div class="header-info">
      <h3>Items del Paquete</h3>
      <p class="text-muted">
        {{ itemsCount() }} {{ itemsCount() === 1 ? 'item incluido' : 'items incluidos' }}
      </p>
    </div>

    <div class="header-actions">
      <p-button label="+ Agregar Item" icon="pi pi-plus" (onClick)="onAddItem()" size="small" />
    </div>
  </div>

  <!-- Items Table -->
  <div class="table-container">
    @if (loading()) {
    <div class="loading-overlay">
      <i class="pi pi-spin pi-spinner" style="font-size: 1.5rem"></i>
      <p>Cargando items...</p>
    </div>
    } @else if (itemsCount() === 0) {
    <div class="empty-state">
      <i class="pi pi-inbox" style="font-size: 2.5rem; color: var(--text-color-secondary)"></i>
      <p>No hay items agregados. Click en "+ Agregar Item" para comenzar.</p>
    </div>
    } @else {
    <p-table [value]="items()" styleClass="p-datatable-sm" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th>Código</th>
          <th>Nombre</th>
          <th>Categoría</th>
          <th style="text-align: right">Precio Unit.</th>
          <th style="text-align: center">Cantidad</th>
          <th style="text-align: right">Subtotal</th>
          <th style="width: 100px">Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-item>
        <tr>
          <td>
            <span class="item-code">{{ item.item_code }}</span>
          </td>
          <td>{{ item.item_name }}</td>
          <td>
            <p-tag
              [value]="getItemTypeLabel(item.item_type)"
              [severity]="getItemTypeSeverity(item.item_type)"
            />
          </td>
          <td style="text-align: right">{{ formatCurrency(item.item_unit_price) }}</td>
          <td style="text-align: center">
            <span class="quantity-badge">{{ item.quantity }}</span>
          </td>
          <td style="text-align: right">
            <span class="font-semibold">{{ formatCurrency(getItemSubtotal(item)) }}</span>
          </td>
          <td>
            <p-button
              icon="pi pi-trash"
              (onClick)="onRemoveItem(item)"
              [text]="true"
              [rounded]="true"
              severity="danger"
              size="small"
              pTooltip="Remover"
            />
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="footer">
        <tr>
          <td colspan="5" style="text-align: right">
            <strong>Subtotal Items:</strong>
          </td>
          <td style="text-align: right">
            <strong class="subtotal-value">{{ formatCurrency(subtotal()) }}</strong>
          </td>
          <td></td>
        </tr>
      </ng-template>
    </p-table>
    }
  </div>
</div>
